/* =========================
    ENGLISH QUESTIONS
    ========================= */
let englishQuestions=[
    { question: "Chaitu and Manku were famous painters of which region?", options:["Kangra","Garhwal","Kumaon","Kashi"], answer:"Garhwal" },
    { question: "Chaitu and Manku were painters in the court of which king?", options:["Prithvi Narayan Shah","Pratap Shah","Sudarshan Shah","Ajit Shah"], answer:"Sudarshan Shah" },
    { question: "What was the reign period of King Sudarshan Shah?", options:["1750–1800","1804–1859","1815–1865","1799–1850"], answer:"1804–1859" },
    { question: "“Yadviyon ka Haran” is the artwork of which painter?", options:["Manku","Chaitu","Nainsukh","Manik Sen"], answer:"Chaitu" },
    { question: "Who painted “Krishna Dwara Kar Vasuli”?", options:["Manku","Chaitu","Nainsukh","King Sudarshan Shah"], answer:"Chaitu" },
    { question: "What inscription is found on the painting Rukmani Haran?", options:["Work of Manku","From King Sudarshan Shah","From Chaitu's house","Kangra Style"], answer:"From Chaitu's house" },
    { question: "Where is the painting “Rukmani Haran” preserved at present?", options:["Delhi Museum","Lucknow Art Collection","Bharatiya Kala Sangrahalaya, Varanasi","Patnangal Museum"], answer:"Bharatiya Kala Sangrahalaya, Varanasi" },
    { question: "Who made the illustration based on “Geet Govind”?", options:["Jayadeva","Chaitu","Manku","King Sudarshan Shah"], answer:"Manku" },
    { question: "The painting “Ankh Micholi” is the work of?", options:["Chaitu","Manku","Jayadeva","Nainsukh"], answer:"Manku" },
    { question: "Manku’s painting style shows the influence of which art form?", options:["Pandava Style","Mughal Style","Kangra Style","Bengal Style"], answer:"Kangra Style" },
    { question: "Chaitu and Manku are considered the last generation of which art form?", options:["Kangra Art","Mughal Art","Pahari Art","Rajasthani Art"], answer:"Pahari Art" },
    { question: "Where was Chaitu residing during the Panwar dynasty?", options:["Devalgarh","Srinagar","Tehri","Pauri"], answer:"Srinagar" },
    { question: "After Sudarshan Shah established Tehri State, where did Chaitu move?", options:["Pauri","Dehradun","Tehri","Almora"], answer:"Tehri" },
    { question: "Manku was a native of which place?", options:["Almora","Devalgarh, Rampur village, Pauri","Srinagar","Chamoli"], answer:"Devalgarh, Rampur village, Pauri" },
    { question: "Who is the author of ‘Geet Govind’?", options:["Tulsidas","Surdas","Jayadeva","Kalidasa"], answer:"Jayadeva" },
    { question: "How many paintings of the ‘Rukmini Haran’ series are preserved in the Bharatiya Kala Sangrahalaya?", options:["12","13","14","15"], answer:"13" },
    { question: "In which year did Manku paint ‘Ankh Micholi’?", options:["1701","1702","1730","1704"], answer:"1730" },
    { question: "What type of painting is ‘Ankh Micholi’?", options:["Black & White","Sculpture","Colored","Line Drawing"], answer:"Colored" },
    { question: "The painting ‘Ankh Micholi’ was obtained from the collection of which Tehri king?", options:["King Mahipat Shah","King Narendra Shah","King Sudarshan Shah","King Pratap Shah"], answer:"King Narendra Shah" },
    { question: "“Sati ka Tap” is the artwork of?", options:["Manku","Chaitu","Jayadeva","King Narendra Shah"], answer:"Chaitu" },
    { question: "“Dhaur Mahadev ki Sabha” is the artwork of?", options:["Manku","Chaitu","Panwar","Narendra Shah"], answer:"Chaitu" }
];

/* =========================
    HINDI QUESTIONS (देवनागरी)
    ========================= */
let hindiQuestions=[
    { question: "चैतू और मांकू किस क्षेत्र के प्रसिद्ध चित्रकार थे?", options:["कांगड़ा","गढ़वॉल","कुमाऊँ","काशी"], answer:"गढ़वॉल" },
    { question: "चैतू और मांकू किस राजा के दरबार में चित्रकार थे?", options:["पृथ्वी नारायण शाह","प्रताप शाह","सुदर्शन शाह","अजीत शाह"], answer:"सुदर्शन शाह" },
    { question: "राजा सुदर्शन शाह का शासनकाल  था?", options:["1750–1800","1804–1859","1815–1865","1799–1850"], answer:"1804–1859" },
    { question: "“यादवियों का हरण” किस चित्रकार की कृति है?", options:["मांकू","चैतू","नैनसुख","मणिक सेन"], answer:"चैतू" },
    { question: "“कृष्ण द्वारा कर वसूली” किसने चित्रित किया?", options:["मांकू","चैतू","नैनसुख","राजा सुदर्शन शाह"], answer:"चैतू" },
    { question: "चित्र 'रुक्मिणी हरण' पर क्या शिलालेख मिलता है?", options:["मांकू का कार्य","राजा सुदर्शन शाह से","चैतू के घर से","कांगड़ा शैली"], answer:"चैतू के घर से" },
    { question: "चित्र 'रुक्मिणी हरण' वर्तमान में कहाँ संरक्षित है?", options:["दिल्ली संग्रहालय","लखनऊ कला संग्रह","भारतीय कला संगराहालय, वाराणसी","पटनंगल संग्रहालय"], answer:"भारतीय कला संगराहालय, वाराणसी" },
    { question: "किसने 'गीत गोविन्द' पर आधारित चित्र बनाया?", options:["जयदेव","चैतू","मांकू","राजा सुदर्शन शाह"], answer:"मांकू" },
    { question: "चित्र 'आँख मिचौली' किसका कार्य है?", options:["चैतू","मांकू","जयदेव","नैनसुख"], answer:"मांकू" },
    { question: "मांकू की चित्रशैली किस कला से प्रभावित दिखती है?", options:["पांडव शैली","मुगल शैली","कांगड़ा या गुलेर शैली ","बंगाल शैली"], answer:"कांगड़ा या गुलेर शैली" },
    { question: "चैतू और मांकू को किस कला की अंतिम पीढ़ी माना जाता है?", options:["कांगड़ा कला","मुगल कला","पहाड़ी कला","राजस्थानी कला"], answer:"पहाड़ी कला" },
    { question: "पंवार वंश के दौरान चैतू कहाँ निवास कर रहे थे?", options:["देवलगढ़","श्रीनगर","टिहरी","पौड़ी"], answer:"श्रीनगर" },
    { question: "जब सुदर्शन शाह ने टिहरी राज्य स्थापित किया, तो चैतू कहाँ चले गए?", options:["पौड़ी","देहरादून","टिहरी","अल्मोड़ा"], answer:"टिहरी" },
    { question: "मांकू किस स्थान के निवासी थे?", options:["देवलगढ़, रामपुर गाँव,अल्मोड़ा","देवलगढ़, रामपुर गाँव, पौड़ी","देवलगढ़, रामपुर गाँव,श्रीनगर","देवलगढ़, रामपुर गाँव,चमोली"], answer:"देवलगढ़, रामपुर गाँव, पौड़ी" },
    { question: "‘गीत गोविन्द’ के लेखक कौन हैं?", options:["तुलसीदास","मांकू","जयदेव","कालिदास"], answer:"जयदेव" },
    { question: "‘रुक्मिणी हरण’ श्रृंखला की कितनी चित्रकृतियाँ भारतीय कला संगराहालय में संचित हैं?", options:["12","13","14","15"], answer:"13" },
    { question: "मांकू ने 'आँख मिचौली' किस वर्ष चित्रित की?", options:["1701","1702","1730","1704"], answer:"1730" },
    { question: "चित्र 'आँख मिचौली' किस प्रकार का चित्र है?", options:["काला और सफेद","मूर्ति","रंगीन","रेखाचित्र"], answer:"रंगीन" },
    { question: "चित्र 'आँख मिचौली' किस टिहरी राजा के संग्रह से प्राप्त हुआ था?", options:["राजा महिपत शाह","राजा नरेंद्र शाह","राजा सुदर्शन शाह","राजा प्रताप शाह"], answer:"राजा नरेंद्र शाह" },
    { question: "“सती का तप” किसकी कृति है?", options:["मांकू","चैतू","जयदेव","राजा नरेंद्र शाह"], answer:"चैतू" },
    { question: "“धौर महादेव की सभा” किसकी कृति है?", options:["मांकू","चैतू","पंवार","नरेंद्र शाह"], answer:"चैतू" }
];

let currentQuestion=0,score=0,selectedAnswers={},questions=[],totalTime=0,timer,attemptedCount=0,isPaused=false;

// Fisher–Yates shuffle
function shuffle(array){
    for(let i=array.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [array[i],array[j]]=[array[j],array[i]];
    }
    return array;
}

function startQuiz(lang){
    questions=(lang==='en'?JSON.parse(JSON.stringify(englishQuestions)):JSON.parse(JSON.stringify(hindiQuestions)));
    shuffle(questions); // shuffle questions
    // shuffle options inside each question
    questions.forEach(q=>shuffle(q.options));
    totalTime=questions.length*8;  // 8 sec per question
    document.getElementById('start-screen').style.display='none';
    document.getElementById('quiz').style.display='block';
    document.getElementById('bottom-row').style.display='block';
    document.getElementById('top-row').style.display='flex';
    document.getElementById('question-panel').style.display='block';
    renderQuestion(); renderPanel(); startTimer();
}

function renderQuestion(){
    let q=questions[currentQuestion];
    let html=`<div class="question"><h3>Q${currentQuestion+1}. ${q.question}</h3><ul class="options">`;
    q.options.forEach(opt=>{
        let cls="",sel=selectedAnswers[currentQuestion];
        if(sel){ if(opt===q.answer) cls="correct"; else if(opt===sel) cls="wrong"; }
        html+=`<li class="${cls}" onclick="selectOption('${encodeURIComponent(opt)}')">${opt}</li>`;
    });
    html+=`</ul></div>`;
    document.getElementById('quiz').innerHTML=html;
    updateProgress(); updatePanelHighlight();
}

function selectOption(opt){
    opt = decodeURIComponent(opt); // decode the encoded option (fixes apostrophe click issue)
    if(selectedAnswers[currentQuestion]) return;
    selectedAnswers[currentQuestion]=opt;
    if(opt===questions[currentQuestion].answer){score++;}
    attemptedCount++; document.getElementById('attempted').innerText=attemptedCount;
    renderQuestion();
    let percent=Math.round((attemptedCount/questions.length)*100);
    document.getElementById('percentage').innerText=percent+"%";
    if(attemptedCount===questions.length){submitQuiz();}
}

function nextQ(){ if(currentQuestion<questions.length-1){currentQuestion++; renderQuestion();}}
function prevQ(){ if(currentQuestion>0){currentQuestion--; renderQuestion();}}

function renderPanel(){
    let cont=document.getElementById('qnum-container'); cont.innerHTML="";
    questions.forEach((q,i)=>{
        let div=document.createElement('div'); div.className="qnum"; div.innerText=i+1;
        div.onclick=()=>{currentQuestion=i; renderQuestion();};
        cont.appendChild(div);
    });
}

function updatePanelHighlight(){
    document.querySelectorAll('.qnum').forEach((el,i)=>{
        el.classList.remove('current','attempted');
        if(i===currentQuestion) el.classList.add('current');
        if(selectedAnswers[i]) el.classList.add('attempted');
    });
}

function updateProgress(){
    let percent=(attemptedCount/questions.length)*100;
    document.getElementById('progress-bar').style.width=percent+"%";
}

function startTimer(){
    timer=setInterval(()=>{
        if(!isPaused){
            totalTime--; let m=Math.floor(totalTime/60),s=totalTime%60;
            document.getElementById('timer').innerText=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
            if(totalTime<=0){clearInterval(timer); submitQuiz();}
        }
    },1000);
}

document.getElementById('pauseBtn').onclick=function(){
    isPaused=!isPaused;
    this.textContent=isPaused?'▶ Play':'⏸ Pause';
};

function submitQuiz(){
    clearInterval(timer);
    let percent=Math.round((score/questions.length)*100);
    document.getElementById('result-score').innerText=`Score: ${score}/${questions.length} (${percent}%)`;
    let msg=document.getElementById('result-msg'); msg.className="";
    if(percent>=70){msg.innerText="🎉 Excellent! You did great!"; msg.classList.add('bounce');
        for(let i=0;i<50;i++){let c=document.createElement('div');c.className='confetti';c.style.left=Math.random()*100+'vw';c.style.background=`hsl(${Math.random()*360},100%,50%)`;c.style.animationDuration=(Math.random()*3+2)+'s';document.body.appendChild(c);setTimeout(()=>c.remove(),5000);}}
    else if(percent>=40){msg.innerText="🙂 Good effort! Keep practicing."; msg.classList.add('shake');}
    else{msg.innerText="😟 Needs improvement. Try again.";}
    document.getElementById('result-popup').style.display='flex';
}

function closePopup(){document.getElementById('result-popup').style.display='none';}
function restartQuiz(){location.reload();}

document.getElementById('start-en').onclick=()=>startQuiz('en');
document.getElementById('start-hi').onclick=()=>startQuiz('hi');
document.getElementById('next').onclick=nextQ;
document.getElementById('prev').onclick=prevQ;
document.getElementById('submit').onclick=submitQuiz;
document.getElementById('restart').onclick=restartQuiz;