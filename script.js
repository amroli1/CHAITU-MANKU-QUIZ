/* =========================
    ENGLISH QUESTIONS
    ========================= */
let englishQuestions=[
    { question: "Chaitu and Manku were famous painters of which region?", options:["Kangra","Garhwal","Kumaon","Kashi"], answer:"Garhwal" },
    { question: "Chaitu and Manku were painters in the court of which king?", options:["Prithvi Narayan Shah","Pratap Shah","Sudarshan Shah","Ajit Shah"], answer:"Sudarshan Shah" },
    { question: "What was the reign period of King Sudarshan Shah?", options:["1750â€“1800","1804â€“1859","1815â€“1865","1799â€“1850"], answer:"1804â€“1859" },
    { question: "â€œYadviyon ka Haranâ€ is the artwork of which painter?", options:["Manku","Chaitu","Nainsukh","Manik Sen"], answer:"Chaitu" },
    { question: "Who painted â€œKrishna Dwara Kar Vasuliâ€?", options:["Manku","Chaitu","Nainsukh","King Sudarshan Shah"], answer:"Chaitu" },
    { question: "What inscription is found on the painting Rukmani Haran?", options:["Work of Manku","From King Sudarshan Shah","From Chaitu's house","Kangra Style"], answer:"From Chaitu's house" },
    { question: "Where is the painting â€œRukmani Haranâ€ preserved at present?", options:["Delhi Museum","Lucknow Art Collection","Bharatiya Kala Sangrahalaya, Varanasi","Patnangal Museum"], answer:"Bharatiya Kala Sangrahalaya, Varanasi" },
    { question: "Who made the illustration based on â€œGeet Govindâ€?", options:["Jayadeva","Chaitu","Manku","King Sudarshan Shah"], answer:"Manku" },
    { question: "The painting â€œAnkh Micholiâ€ is the work of?", options:["Chaitu","Manku","Jayadeva","Nainsukh"], answer:"Manku" },
    { question: "Mankuâ€™s painting style shows the influence of which art form?", options:["Pandava Style","Mughal Style","Kangra Style","Bengal Style"], answer:"Kangra Style" },
    { question: "Chaitu and Manku are considered the last generation of which art form?", options:["Kangra Art","Mughal Art","Pahari Art","Rajasthani Art"], answer:"Pahari Art" },
    { question: "Where was Chaitu residing during the Panwar dynasty?", options:["Devalgarh","Srinagar","Tehri","Pauri"], answer:"Srinagar" },
    { question: "After Sudarshan Shah established Tehri State, where did Chaitu move?", options:["Pauri","Dehradun","Tehri","Almora"], answer:"Tehri" },
    { question: "Manku was a native of which place?", options:["Almora","Devalgarh, Rampur village, Pauri","Srinagar","Chamoli"], answer:"Devalgarh, Rampur village, Pauri" },
    { question: "Who is the author of â€˜Geet Govindâ€™?", options:["Tulsidas","Surdas","Jayadeva","Kalidasa"], answer:"Jayadeva" },
    { question: "How many paintings of the â€˜Rukmini Haranâ€™ series are preserved in the Bharatiya Kala Sangrahalaya?", options:["12","13","14","15"], answer:"13" },
    { question: "In which year did Manku paint â€˜Ankh Micholiâ€™?", options:["1701","1702","1730","1704"], answer:"1730" },
    { question: "What type of painting is â€˜Ankh Micholiâ€™?", options:["Black & White","Sculpture","Colored","Line Drawing"], answer:"Colored" },
    { question: "The painting â€˜Ankh Micholiâ€™ was obtained from the collection of which Tehri king?", options:["King Mahipat Shah","King Narendra Shah","King Sudarshan Shah","King Pratap Shah"], answer:"King Narendra Shah" },
    { question: "â€œSati ka Tapâ€ is the artwork of?", options:["Manku","Chaitu","Jayadeva","King Narendra Shah"], answer:"Chaitu" },
    { question: "â€œDhaur Mahadev ki Sabhaâ€ is the artwork of?", options:["Manku","Chaitu","Panwar","Narendra Shah"], answer:"Chaitu" }
];

/* =========================
    HINDI QUESTIONS (à¤¦à¥‡à¤µà¤¨à¤¾à¤—à¤°à¥€)
    ========================= */
let hindiQuestions=[
    { question: "à¤šà¥ˆà¤¤à¥‚ à¤”à¤° à¤®à¤¾à¤‚à¤•à¥‚ à¤•à¤¿à¤¸ à¤•à¥à¤·à¥‡à¤¤à¥à¤° à¤•à¥‡ à¤ªà¥à¤°à¤¸à¤¿à¤¦à¥à¤§ à¤šà¤¿à¤¤à¥à¤°à¤•à¤¾à¤° à¤¥à¥‡?", options:["à¤•à¤¾à¤‚à¤—à¤¡à¤¼à¤¾","à¤—à¤¢à¤¼à¤µà¥‰à¤²","à¤•à¥à¤®à¤¾à¤Šà¤","à¤•à¤¾à¤¶à¥€"], answer:"à¤—à¤¢à¤¼à¤µà¥‰à¤²" },
    { question: "à¤šà¥ˆà¤¤à¥‚ à¤”à¤° à¤®à¤¾à¤‚à¤•à¥‚ à¤•à¤¿à¤¸ à¤°à¤¾à¤œà¤¾ à¤•à¥‡ à¤¦à¤°à¤¬à¤¾à¤° à¤®à¥‡à¤‚ à¤šà¤¿à¤¤à¥à¤°à¤•à¤¾à¤° à¤¥à¥‡?", options:["à¤ªà¥ƒà¤¥à¥à¤µà¥€ à¤¨à¤¾à¤°à¤¾à¤¯à¤£ à¤¶à¤¾à¤¹","à¤ªà¥à¤°à¤¤à¤¾à¤ª à¤¶à¤¾à¤¹","à¤¸à¥à¤¦à¤°à¥à¤¶à¤¨ à¤¶à¤¾à¤¹","à¤…à¤œà¥€à¤¤ à¤¶à¤¾à¤¹"], answer:"à¤¸à¥à¤¦à¤°à¥à¤¶à¤¨ à¤¶à¤¾à¤¹" },
    { question: "à¤°à¤¾à¤œà¤¾ à¤¸à¥à¤¦à¤°à¥à¤¶à¤¨ à¤¶à¤¾à¤¹ à¤•à¤¾ à¤¶à¤¾à¤¸à¤¨à¤•à¤¾à¤²Â  à¤¥à¤¾?", options:["1750â€“1800","1804â€“1859","1815â€“1865","1799â€“1850"], answer:"1804â€“1859" },
    { question: "â€œà¤¯à¤¾à¤¦à¤µà¤¿à¤¯à¥‹à¤‚ à¤•à¤¾ à¤¹à¤°à¤£â€ à¤•à¤¿à¤¸ à¤šà¤¿à¤¤à¥à¤°à¤•à¤¾à¤° à¤•à¥€ à¤•à¥ƒà¤¤à¤¿ à¤¹à¥ˆ?", options:["à¤®à¤¾à¤‚à¤•à¥‚","à¤šà¥ˆà¤¤à¥‚","à¤¨à¥ˆà¤¨à¤¸à¥à¤–","à¤®à¤£à¤¿à¤• à¤¸à¥‡à¤¨"], answer:"à¤šà¥ˆà¤¤à¥‚" },
    { question: "â€œà¤•à¥ƒà¤·à¥à¤£ à¤¦à¥à¤µà¤¾à¤°à¤¾ à¤•à¤° à¤µà¤¸à¥‚à¤²à¥€â€ à¤•à¤¿à¤¸à¤¨à¥‡ à¤šà¤¿à¤¤à¥à¤°à¤¿à¤¤ à¤•à¤¿à¤¯à¤¾?", options:["à¤®à¤¾à¤‚à¤•à¥‚","à¤šà¥ˆà¤¤à¥‚","à¤¨à¥ˆà¤¨à¤¸à¥à¤–","à¤°à¤¾à¤œà¤¾ à¤¸à¥à¤¦à¤°à¥à¤¶à¤¨ à¤¶à¤¾à¤¹"], answer:"à¤šà¥ˆà¤¤à¥‚" },
    { question: "à¤šà¤¿à¤¤à¥à¤° 'à¤°à¥à¤•à¥à¤®à¤¿à¤£à¥€ à¤¹à¤°à¤£' à¤ªà¤° à¤•à¥à¤¯à¤¾ à¤¶à¤¿à¤²à¤¾à¤²à¥‡à¤– à¤®à¤¿à¤²à¤¤à¤¾ à¤¹à¥ˆ?", options:["à¤®à¤¾à¤‚à¤•à¥‚ à¤•à¤¾ à¤•à¤¾à¤°à¥à¤¯","à¤°à¤¾à¤œà¤¾ à¤¸à¥à¤¦à¤°à¥à¤¶à¤¨ à¤¶à¤¾à¤¹ à¤¸à¥‡","à¤šà¥ˆà¤¤à¥‚ à¤•à¥‡ à¤˜à¤° à¤¸à¥‡","à¤•à¤¾à¤‚à¤—à¤¡à¤¼à¤¾ à¤¶à¥ˆà¤²à¥€"], answer:"à¤šà¥ˆà¤¤à¥‚ à¤•à¥‡ à¤˜à¤° à¤¸à¥‡" },
    { question: "à¤šà¤¿à¤¤à¥à¤° 'à¤°à¥à¤•à¥à¤®à¤¿à¤£à¥€ à¤¹à¤°à¤£' à¤µà¤°à¥à¤¤à¤®à¤¾à¤¨ à¤®à¥‡à¤‚ à¤•à¤¹à¤¾à¤ à¤¸à¤‚à¤°à¤•à¥à¤·à¤¿à¤¤ à¤¹à¥ˆ?", options:["à¤¦à¤¿à¤²à¥à¤²à¥€ à¤¸à¤‚à¤—à¥à¤°à¤¹à¤¾à¤²à¤¯","à¤²à¤–à¤¨à¤Š à¤•à¤²à¤¾ à¤¸à¤‚à¤—à¥à¤°à¤¹","à¤­à¤¾à¤°à¤¤à¥€à¤¯ à¤•à¤²à¤¾ à¤¸à¤‚à¤—à¤°à¤¾à¤¹à¤¾à¤²à¤¯, à¤µà¤¾à¤°à¤¾à¤£à¤¸à¥€","à¤ªà¤Ÿà¤¨à¤‚à¤—à¤² à¤¸à¤‚à¤—à¥à¤°à¤¹à¤¾à¤²à¤¯"], answer:"à¤­à¤¾à¤°à¤¤à¥€à¤¯ à¤•à¤²à¤¾ à¤¸à¤‚à¤—à¤°à¤¾à¤¹à¤¾à¤²à¤¯, à¤µà¤¾à¤°à¤¾à¤£à¤¸à¥€" },
    { question: "à¤•à¤¿à¤¸à¤¨à¥‡ 'à¤—à¥€à¤¤ à¤—à¥‹à¤µà¤¿à¤¨à¥à¤¦' à¤ªà¤° à¤†à¤§à¤¾à¤°à¤¿à¤¤ à¤šà¤¿à¤¤à¥à¤° à¤¬à¤¨à¤¾à¤¯à¤¾?", options:["à¤œà¤¯à¤¦à¥‡à¤µ","à¤šà¥ˆà¤¤à¥‚","à¤®à¤¾à¤‚à¤•à¥‚","à¤°à¤¾à¤œà¤¾ à¤¸à¥à¤¦à¤°à¥à¤¶à¤¨ à¤¶à¤¾à¤¹"], answer:"à¤®à¤¾à¤‚à¤•à¥‚" },
    { question: "à¤šà¤¿à¤¤à¥à¤° 'à¤†à¤à¤– à¤®à¤¿à¤šà¥Œà¤²à¥€' à¤•à¤¿à¤¸à¤•à¤¾ à¤•à¤¾à¤°à¥à¤¯ à¤¹à¥ˆ?", options:["à¤šà¥ˆà¤¤à¥‚","à¤®à¤¾à¤‚à¤•à¥‚","à¤œà¤¯à¤¦à¥‡à¤µ","à¤¨à¥ˆà¤¨à¤¸à¥à¤–"], answer:"à¤®à¤¾à¤‚à¤•à¥‚" },
    { question: "à¤®à¤¾à¤‚à¤•à¥‚ à¤•à¥€ à¤šà¤¿à¤¤à¥à¤°à¤¶à¥ˆà¤²à¥€ à¤•à¤¿à¤¸ à¤•à¤²à¤¾ à¤¸à¥‡ à¤ªà¥à¤°à¤­à¤¾à¤µà¤¿à¤¤ à¤¦à¤¿à¤–à¤¤à¥€ à¤¹à¥ˆ?", options:["à¤ªà¤¾à¤‚à¤¡à¤µ à¤¶à¥ˆà¤²à¥€","à¤®à¥à¤—à¤² à¤¶à¥ˆà¤²à¥€","à¤•à¤¾à¤‚à¤—à¤¡à¤¼à¤¾ à¤¯à¤¾ à¤—à¥à¤²à¥‡à¤° à¤¶à¥ˆà¤²à¥€ ","à¤¬à¤‚à¤—à¤¾à¤² à¤¶à¥ˆà¤²à¥€"], answer:"à¤•à¤¾à¤‚à¤—à¤¡à¤¼à¤¾ à¤¯à¤¾ à¤—à¥à¤²à¥‡à¤° à¤¶à¥ˆà¤²à¥€" },
    { question: "à¤šà¥ˆà¤¤à¥‚ à¤”à¤° à¤®à¤¾à¤‚à¤•à¥‚ à¤•à¥‹ à¤•à¤¿à¤¸ à¤•à¤²à¤¾ à¤•à¥€ à¤…à¤‚à¤¤à¤¿à¤® à¤ªà¥€à¤¢à¤¼à¥€ à¤®à¤¾à¤¨à¤¾ à¤œà¤¾à¤¤à¤¾ à¤¹à¥ˆ?", options:["à¤•à¤¾à¤‚à¤—à¤¡à¤¼à¤¾ à¤•à¤²à¤¾","à¤®à¥à¤—à¤² à¤•à¤²à¤¾","à¤ªà¤¹à¤¾à¤¡à¤¼à¥€ à¤•à¤²à¤¾","à¤°à¤¾à¤œà¤¸à¥à¤¥à¤¾à¤¨à¥€ à¤•à¤²à¤¾"], answer:"à¤ªà¤¹à¤¾à¤¡à¤¼à¥€ à¤•à¤²à¤¾" },
    { question: "à¤ªà¤‚à¤µà¤¾à¤° à¤µà¤‚à¤¶ à¤•à¥‡ à¤¦à¥Œà¤°à¤¾à¤¨ à¤šà¥ˆà¤¤à¥‚ à¤•à¤¹à¤¾à¤ à¤¨à¤¿à¤µà¤¾à¤¸ à¤•à¤° à¤°à¤¹à¥‡ à¤¥à¥‡?", options:["à¤¦à¥‡à¤µà¤²à¤—à¤¢à¤¼","à¤¶à¥à¤°à¥€à¤¨à¤—à¤°","à¤Ÿà¤¿à¤¹à¤°à¥€","à¤ªà¥Œà¤¡à¤¼à¥€"], answer:"à¤¶à¥à¤°à¥€à¤¨à¤—à¤°" },
    { question: "à¤œà¤¬ à¤¸à¥à¤¦à¤°à¥à¤¶à¤¨ à¤¶à¤¾à¤¹ à¤¨à¥‡ à¤Ÿà¤¿à¤¹à¤°à¥€ à¤°à¤¾à¤œà¥à¤¯ à¤¸à¥à¤¥à¤¾à¤ªà¤¿à¤¤ à¤•à¤¿à¤¯à¤¾, à¤¤à¥‹ à¤šà¥ˆà¤¤à¥‚ à¤•à¤¹à¤¾à¤ à¤šà¤²à¥‡ à¤—à¤?", options:["à¤ªà¥Œà¤¡à¤¼à¥€","à¤¦à¥‡à¤¹à¤°à¤¾à¤¦à¥‚à¤¨","à¤Ÿà¤¿à¤¹à¤°à¥€","à¤…à¤²à¥à¤®à¥‹à¤¡à¤¼à¤¾"], answer:"à¤Ÿà¤¿à¤¹à¤°à¥€" },
    { question: "à¤®à¤¾à¤‚à¤•à¥‚ à¤•à¤¿à¤¸ à¤¸à¥à¤¥à¤¾à¤¨ à¤•à¥‡ à¤¨à¤¿à¤µà¤¾à¤¸à¥€ à¤¥à¥‡?", options:["à¤¦à¥‡à¤µà¤²à¤—à¤¢à¤¼, à¤°à¤¾à¤®à¤ªà¥à¤° à¤—à¤¾à¤à¤µ,à¤…à¤²à¥à¤®à¥‹à¤¡à¤¼à¤¾","à¤¦à¥‡à¤µà¤²à¤—à¤¢à¤¼, à¤°à¤¾à¤®à¤ªà¥à¤° à¤—à¤¾à¤à¤µ, à¤ªà¥Œà¤¡à¤¼à¥€","à¤¦à¥‡à¤µà¤²à¤—à¤¢à¤¼, à¤°à¤¾à¤®à¤ªà¥à¤° à¤—à¤¾à¤à¤µ,à¤¶à¥à¤°à¥€à¤¨à¤—à¤°","à¤¦à¥‡à¤µà¤²à¤—à¤¢à¤¼, à¤°à¤¾à¤®à¤ªà¥à¤° à¤—à¤¾à¤à¤µ,à¤šà¤®à¥‹à¤²à¥€"], answer:"à¤¦à¥‡à¤µà¤²à¤—à¤¢à¤¼, à¤°à¤¾à¤®à¤ªà¥à¤° à¤—à¤¾à¤à¤µ, à¤ªà¥Œà¤¡à¤¼à¥€" },
    { question: "â€˜à¤—à¥€à¤¤ à¤—à¥‹à¤µà¤¿à¤¨à¥à¤¦â€™ à¤•à¥‡ à¤²à¥‡à¤–à¤• à¤•à¥Œà¤¨ à¤¹à¥ˆà¤‚?", options:["à¤¤à¥à¤²à¤¸à¥€à¤¦à¤¾à¤¸","à¤®à¤¾à¤‚à¤•à¥‚","à¤œà¤¯à¤¦à¥‡à¤µ","à¤•à¤¾à¤²à¤¿à¤¦à¤¾à¤¸"], answer:"à¤œà¤¯à¤¦à¥‡à¤µ" },
    { question: "â€˜à¤°à¥à¤•à¥à¤®à¤¿à¤£à¥€ à¤¹à¤°à¤£â€™ à¤¶à¥à¤°à¥ƒà¤‚à¤–à¤²à¤¾ à¤•à¥€ à¤•à¤¿à¤¤à¤¨à¥€ à¤šà¤¿à¤¤à¥à¤°à¤•à¥ƒà¤¤à¤¿à¤¯à¤¾à¤ à¤­à¤¾à¤°à¤¤à¥€à¤¯ à¤•à¤²à¤¾ à¤¸à¤‚à¤—à¤°à¤¾à¤¹à¤¾à¤²à¤¯ à¤®à¥‡à¤‚ à¤¸à¤‚à¤šà¤¿à¤¤ à¤¹à¥ˆà¤‚?", options:["12","13","14","15"], answer:"13" },
    { question: "à¤®à¤¾à¤‚à¤•à¥‚ à¤¨à¥‡ 'à¤†à¤à¤– à¤®à¤¿à¤šà¥Œà¤²à¥€' à¤•à¤¿à¤¸ à¤µà¤°à¥à¤· à¤šà¤¿à¤¤à¥à¤°à¤¿à¤¤ à¤•à¥€?", options:["1701","1702","1730","1704"], answer:"1730" },
    { question: "à¤šà¤¿à¤¤à¥à¤° 'à¤†à¤à¤– à¤®à¤¿à¤šà¥Œà¤²à¥€' à¤•à¤¿à¤¸ à¤ªà¥à¤°à¤•à¤¾à¤° à¤•à¤¾ à¤šà¤¿à¤¤à¥à¤° à¤¹à¥ˆ?", options:["à¤•à¤¾à¤²à¤¾ à¤”à¤° à¤¸à¤«à¥‡à¤¦","à¤®à¥‚à¤°à¥à¤¤à¤¿","à¤°à¤‚à¤—à¥€à¤¨","à¤°à¥‡à¤–à¤¾à¤šà¤¿à¤¤à¥à¤°"], answer:"à¤°à¤‚à¤—à¥€à¤¨" },
    { question: "à¤šà¤¿à¤¤à¥à¤° 'à¤†à¤à¤– à¤®à¤¿à¤šà¥Œà¤²à¥€' à¤•à¤¿à¤¸ à¤Ÿà¤¿à¤¹à¤°à¥€ à¤°à¤¾à¤œà¤¾ à¤•à¥‡ à¤¸à¤‚à¤—à¥à¤°à¤¹ à¤¸à¥‡ à¤ªà¥à¤°à¤¾à¤ªà¥à¤¤ à¤¹à¥à¤† à¤¥à¤¾?", options:["à¤°à¤¾à¤œà¤¾ à¤®à¤¹à¤¿à¤ªà¤¤ à¤¶à¤¾à¤¹","à¤°à¤¾à¤œà¤¾ à¤¨à¤°à¥‡à¤‚à¤¦à¥à¤° à¤¶à¤¾à¤¹","à¤°à¤¾à¤œà¤¾ à¤¸à¥à¤¦à¤°à¥à¤¶à¤¨ à¤¶à¤¾à¤¹","à¤°à¤¾à¤œà¤¾ à¤ªà¥à¤°à¤¤à¤¾à¤ª à¤¶à¤¾à¤¹"], answer:"à¤°à¤¾à¤œà¤¾ à¤¨à¤°à¥‡à¤‚à¤¦à¥à¤° à¤¶à¤¾à¤¹" },
    { question: "â€œà¤¸à¤¤à¥€ à¤•à¤¾ à¤¤à¤ªâ€ à¤•à¤¿à¤¸à¤•à¥€ à¤•à¥ƒà¤¤à¤¿ à¤¹à¥ˆ?", options:["à¤®à¤¾à¤‚à¤•à¥‚","à¤šà¥ˆà¤¤à¥‚","à¤œà¤¯à¤¦à¥‡à¤µ","à¤°à¤¾à¤œà¤¾ à¤¨à¤°à¥‡à¤‚à¤¦à¥à¤° à¤¶à¤¾à¤¹"], answer:"à¤šà¥ˆà¤¤à¥‚" },
    { question: "â€œà¤§à¥Œà¤° à¤®à¤¹à¤¾à¤¦à¥‡à¤µ à¤•à¥€ à¤¸à¤­à¤¾â€ à¤•à¤¿à¤¸à¤•à¥€ à¤•à¥ƒà¤¤à¤¿ à¤¹à¥ˆ?", options:["à¤®à¤¾à¤‚à¤•à¥‚","à¤šà¥ˆà¤¤à¥‚","à¤ªà¤‚à¤µà¤¾à¤°","à¤¨à¤°à¥‡à¤‚à¤¦à¥à¤° à¤¶à¤¾à¤¹"], answer:"à¤šà¥ˆà¤¤à¥‚" }
];

let currentQuestion=0,score=0,selectedAnswers={},questions=[],totalTime=0,timer,attemptedCount=0,isPaused=false;

// Fisherâ€“Yates shuffle
function shuffle(array){
    for(let i=array.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [array[i],array[j]]=[array[j],array[i]];
    }
    return array;
}

function startQuiz(lang){
    questions=(lang==='en'?JSON.parse(JSON.stringify(englishQuestions)):JSON.parse(JSON.stringify(hindiQuestions)));
    shuffle(questions); // shuffle questions
    // shuffle options inside each question
    questions.forEach(q=>shuffle(q.options));
    totalTime=questions.length*8;  // 8 sec per question
    document.getElementById('start-screen').style.display='none';
    document.getElementById('quiz').style.display='block';
    document.getElementById('bottom-row').style.display='block';
    document.getElementById('top-row').style.display='flex';
    document.getElementById('question-panel').style.display='block';
    renderQuestion(); renderPanel(); startTimer();
}

function renderQuestion(){
    let q=questions[currentQuestion];
    let html=`<div class="question"><h3>Q${currentQuestion+1}. ${q.question}</h3><ul class="options">`;
    q.options.forEach(opt=>{
        let cls="",sel=selectedAnswers[currentQuestion];
        if(sel){ if(opt===q.answer) cls="correct"; else if(opt===sel) cls="wrong"; }
        html+=`<li class="${cls}" onclick="selectOption('${encodeURIComponent(opt)}')">${opt}</li>`;
    });
    html+=`</ul></div>`;
    document.getElementById('quiz').innerHTML=html;
    updateProgress(); updatePanelHighlight();
}

function selectOption(opt){
    opt = decodeURIComponent(opt); // decode the encoded option (fixes apostrophe click issue)
    if(selectedAnswers[currentQuestion]) return;
    selectedAnswers[currentQuestion]=opt;
    if(opt===questions[currentQuestion].answer){score++;}
    attemptedCount++; document.getElementById('attempted').innerText=attemptedCount;
    renderQuestion();
    let percent=Math.round((attemptedCount/questions.length)*100);
    document.getElementById('percentage').innerText=percent+"%";
    if(attemptedCount===questions.length){submitQuiz();}
}

function nextQ(){ if(currentQuestion<questions.length-1){currentQuestion++; renderQuestion();}}
function prevQ(){ if(currentQuestion>0){currentQuestion--; renderQuestion();}}

function renderPanel(){
    let cont=document.getElementById('qnum-container'); cont.innerHTML="";
    questions.forEach((q,i)=>{
        let div=document.createElement('div'); div.className="qnum"; div.innerText=i+1;
        div.onclick=()=>{currentQuestion=i; renderQuestion();};
        cont.appendChild(div);
    });
}

function updatePanelHighlight(){
    document.querySelectorAll('.qnum').forEach((el,i)=>{
        el.classList.remove('current','attempted');
        if(i===currentQuestion) el.classList.add('current');
        if(selectedAnswers[i]) el.classList.add('attempted');
    });
}

function updateProgress(){
    let percent=(attemptedCount/questions.length)*100;
    document.getElementById('progress-bar').style.width=percent+"%";
}

function startTimer(){
    timer=setInterval(()=>{
        if(!isPaused){
            totalTime--; let m=Math.floor(totalTime/60),s=totalTime%60;
            document.getElementById('timer').innerText=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
            if(totalTime<=0){clearInterval(timer); submitQuiz();}
        }
    },1000);
}

document.getElementById('pauseBtn').onclick=function(){
    isPaused=!isPaused;
    this.textContent=isPaused?'â–¶ Play':'â¸ Pause';
};

function submitQuiz(){
    clearInterval(timer);
    let percent=Math.round((score/questions.length)*100);
    document.getElementById('result-score').innerText=`Score: ${score}/${questions.length} (${percent}%)`;
    let msg=document.getElementById('result-msg'); msg.className="";
    if(percent>=70){msg.innerText="ðŸŽ‰ Excellent! You did great!"; msg.classList.add('bounce');
        for(let i=0;i<50;i++){let c=document.createElement('div');c.className='confetti';c.style.left=Math.random()*100+'vw';c.style.background=`hsl(${Math.random()*360},100%,50%)`;c.style.animationDuration=(Math.random()*3+2)+'s';document.body.appendChild(c);setTimeout(()=>c.remove(),5000);}}
    else if(percent>=40){msg.innerText="ðŸ™‚ Good effort! Keep practicing."; msg.classList.add('shake');}
    else{msg.innerText="ðŸ˜Ÿ Needs improvement. Try again.";}
    document.getElementById('result-popup').style.display='flex';
}

function closePopup(){document.getElementById('result-popup').style.display='none';}
function restartQuiz(){location.reload();}

document.getElementById('start-en').onclick=()=>startQuiz('en');
document.getElementById('start-hi').onclick=()=>startQuiz('hi');
document.getElementById('next').onclick=nextQ;
document.getElementById('prev').onclick=prevQ;
document.getElementById('submit').onclick=submitQuiz;
document.getElementById('restart').onclick=restartQuiz;